{% extends 'rr_app/restaurant/rr_base.html' %}
{% load static %}

{% block title %}{{ restaurant.name }} - Restaurant Reservations{% endblock %}

{% block rr_base_css %}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Playfair+Display:wght@400;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="{% static 'rr_app/css/restaurant_detail.css' %}">
<link rel="stylesheet" href="{% static 'rr_app/css/notifications.css' %}">
{% endblock %}

{% block rr_base_content %}
<!-- Restaurant Header -->
<div class="restaurant-header">
    <div class="header-content">
        <div class="restaurant-hero">
            {% if restaurant.image %}
                <div class="hero-image" style="background-image: url('{{ restaurant.image.url }}')"></div>
            {% else %}
                <div class="hero-placeholder">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H5C3.9 1 3 1.9 3 3V21C3 22.1 3.9 23 5 23H19C20.1 23 21 22.1 21 21V9ZM19 19H5V3H14V8H19V19Z"/>
                    </svg>
                    <span>{{ restaurant.name }}</span>
                </div>
            {% endif %}
        </div>
        
        <div class="restaurant-info">
            <div class="info-container">
                <h1 class="restaurant-name">{{ restaurant.name }}</h1>
                <div class="restaurant-details">
                    <div class="rating-display">
                        <div class="stars" data-rating="{{ avg_rating|default:0 }}"></div>
                        <span class="rating-text">{{ avg_rating|floatformat:1 }} ({{ reviews|length }} review{{ reviews|length|pluralize }})</span>
                    </div>
                    <div class="cuisine-info">
                        {% for cuisine in restaurant.cuisines.all %}
                            <span class="cuisine">{{ cuisine }}</span>
                        {% endfor %}
                    </div>
                    <div class="price-range-badge">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M13,9H11V11H9V13H11V15H13V13H15V11H13V9Z"/>
                        </svg>
                        <span>{{ restaurant.price_range_display }}</span>
                    </div>
                    <div class="location-info">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z"/>
                        </svg>
                        <span>{{ restaurant.address }}</span>
                    </div>
                    
                    <div class="hours-info">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M16.2,16.2L11,13V7H12.5V12.2L17,14.7L16.2,16.2Z"/>
                        </svg>
                        <span class="{% if restaurant.is_open_now %}status-open{% else %}status-closed{% endif %}">
                            {% if restaurant.is_open_now %}
                                Open until {{ restaurant.closing_time|time:"g:i A" }}
                            {% else %}
                                {% if restaurant.opening_time %}
                                    Opens at {{ restaurant.opening_time|time:"g:i A" }}
                                {% else %}
                                    Hours not available
                                {% endif %}
                            {% endif %}
                        </span>
                    </div>
                    
                    {% if restaurant.tags.all %}
                    <div class="tags-info">
                        {% for tag in restaurant.tags.all %}
                            <span class="restaurant-tag">{{ tag.tag }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Main Reservation Content -->
<div class="reservation-container">
    <div class="reservation-main">
        
        <!-- Restaurant Information -->
        <section class="restaurant-section">
            <h2>About {{ restaurant.name }}</h2>
            <p class="restaurant-description">{{ restaurant.description }}</p>
            
            <div class="restaurant-features">
                <div class="feature">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M6.62,10.79C8.06,13.62 10.38,15.94 13.21,17.38L15.41,15.18C15.69,14.9 16.08,14.82 16.43,14.93C17.55,15.3 18.75,15.5 20,15.5A1,1 0 0,1 21,16.5V20A1,1 0 0,1 20,21A17,17 0 0,1 3,4A1,1 0 0,1 4,3H7.5A1,1 0 0,1 8.5,4C8.5,5.25 8.7,6.45 9.07,7.57C9.18,7.92 9.1,8.31 8.82,8.59L6.62,10.79Z"/>
                    </svg>
                    <span>{{ restaurant.phone_number }}</span>
                </div>
                <div class="feature">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20,8L12,13L4,8V6L12,11L20,6M20,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6C22,4.89 21.1,4 20,4Z"/>
                    </svg>
                    <span>{{ restaurant.email }}</span>
                </div>
                <div class="feature">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9Z"/>
                    </svg>
                    <span>Maximum {{ restaurant.max_guest_count }} guests</span>
                </div>
            </div>
        </section>

        <!-- Table Selection -->
        <section class="table-section">
            <h2>Select Your Table</h2>
            <div class="table-map-container">
                <div class="floor-legend">
                    <div class="legend-item">
                        <div class="legend-color available"></div>
                        <span>Available</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color reserved"></div>
                        <span>Reserved</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color selected"></div>
                        <span>Selected</span>
                    </div>
                </div>
                
                <div class="floor-plan">
                    <!-- Entrance -->
                    <div class="entrance">
                        <span>Entrance</span>
                    </div>
                    
                    <!-- Windows -->
                    <div class="window window-top">Window</div>
                    <div class="window window-right">Window</div>
                    
                    <!-- Bar Area -->
                    <div class="bar-area">
                        <span>Bar</span>
                    </div>
                    
                    <!-- Tables -->
                    <!-- 2-person tables -->
                    <div class="table table-2 available" data-table="1" data-capacity="2" style="top: 80px; left: 100px;">
                        <svg width="40" height="60" viewBox="0 0 40 60">
                            <rect x="10" y="20" width="20" height="20" rx="4" fill="currentColor"/>
                            <circle cx="15" cy="15" r="3" fill="currentColor"/>
                            <circle cx="25" cy="15" r="3" fill="currentColor"/>
                        </svg>
                        <span class="table-number">1</span>
                    </div>
                    
                    <div class="table table-2 available" data-table="2" data-capacity="2" style="top: 80px; left: 200px;">
                        <svg width="40" height="60" viewBox="0 0 40 60">
                            <rect x="10" y="20" width="20" height="20" rx="4" fill="currentColor"/>
                            <circle cx="15" cy="15" r="3" fill="currentColor"/>
                            <circle cx="25" cy="15" r="3" fill="currentColor"/>
                        </svg>
                        <span class="table-number">2</span>
                    </div>
                    
                    <!-- 4-person tables -->
                    <div class="table table-4 available" data-table="3" data-capacity="4" style="top: 180px; left: 80px;">
                        <svg width="60" height="80" viewBox="0 0 60 80">
                            <rect x="15" y="25" width="30" height="30" rx="6" fill="currentColor"/>
                            <circle cx="20" cy="15" r="4" fill="currentColor"/>
                            <circle cx="40" cy="15" r="4" fill="currentColor"/>
                            <circle cx="20" cy="65" r="4" fill="currentColor"/>
                            <circle cx="40" cy="65" r="4" fill="currentColor"/>
                        </svg>
                        <span class="table-number">3</span>
                    </div>
                    
                    <div class="table table-4 reserved" data-table="4" data-capacity="4" style="top: 180px; left: 200px;">
                        <svg width="60" height="80" viewBox="0 0 60 80">
                            <rect x="15" y="25" width="30" height="30" rx="6" fill="currentColor"/>
                            <circle cx="20" cy="15" r="4" fill="currentColor"/>
                            <circle cx="40" cy="15" r="4" fill="currentColor"/>
                            <circle cx="20" cy="65" r="4" fill="currentColor"/>
                            <circle cx="40" cy="65" r="4" fill="currentColor"/>
                        </svg>
                        <span class="table-number">4</span>
                    </div>
                    
                    <div class="table table-4 available" data-table="5" data-capacity="4" style="top: 300px; left: 140px;">
                        <svg width="60" height="80" viewBox="0 0 60 80">
                            <rect x="15" y="25" width="30" height="30" rx="6" fill="currentColor"/>
                            <circle cx="20" cy="15" r="4" fill="currentColor"/>
                            <circle cx="40" cy="15" r="4" fill="currentColor"/>
                            <circle cx="20" cy="65" r="4" fill="currentColor"/>
                            <circle cx="40" cy="65" r="4" fill="currentColor"/>
                        </svg>
                        <span class="table-number">5</span>
                    </div>
                    
                    <!-- 6-person tables -->
                    <div class="table table-6 available" data-table="6" data-capacity="6" style="top: 200px; left: 360px;">
                        <svg width="80" height="100" viewBox="0 0 80 100">
                            <rect x="20" y="30" width="40" height="40" rx="8" fill="currentColor"/>
                            <circle cx="25" cy="15" r="5" fill="currentColor"/>
                            <circle cx="55" cy="15" r="5" fill="currentColor"/>
                            <circle cx="15" cy="50" r="5" fill="currentColor"/>
                            <circle cx="65" cy="50" r="5" fill="currentColor"/>
                            <circle cx="25" cy="85" r="5" fill="currentColor"/>
                            <circle cx="55" cy="85" r="5" fill="currentColor"/>
                        </svg>
                        <span class="table-number">6</span>
                    </div>
                    
                    <div class="table table-6 available" data-table="7" data-capacity="6" style="top: 350px; left: 320px;">
                        <svg width="80" height="100" viewBox="0 0 80 100">
                            <rect x="20" y="30" width="40" height="40" rx="8" fill="currentColor"/>
                            <circle cx="25" cy="15" r="5" fill="currentColor"/>
                            <circle cx="55" cy="15" r="5" fill="currentColor"/>
                            <circle cx="15" cy="50" r="5" fill="currentColor"/>
                            <circle cx="65" cy="50" r="5" fill="currentColor"/>
                            <circle cx="25" cy="85" r="5" fill="currentColor"/>
                            <circle cx="55" cy="85" r="5" fill="currentColor"/>
                        </svg>
                        <span class="table-number">7</span>
                    </div>
                    
                    <!-- 8-person table -->
                    <div class="table table-8 available" data-table="8" data-capacity="8" style="top: 120px; left: 340px;">
                        <svg width="100" height="120" viewBox="0 0 100 120">
                            <rect x="25" y="35" width="50" height="50" rx="10" fill="currentColor"/>
                            <circle cx="30" cy="15" r="6" fill="currentColor"/>
                            <circle cx="50" cy="15" r="6" fill="currentColor"/>
                            <circle cx="70" cy="15" r="6" fill="currentColor"/>
                            <circle cx="15" cy="40" r="6" fill="currentColor"/>
                            <circle cx="85" cy="40" r="6" fill="currentColor"/>
                            <circle cx="15" cy="80" r="6" fill="currentColor"/>
                            <circle cx="85" cy="80" r="6" fill="currentColor"/>
                            <circle cx="50" cy="105" r="6" fill="currentColor"/>
                        </svg>
                        <span class="table-number">8</span>
                    </div>
                    
                    <!-- Kitchen -->
                    <div class="kitchen">Kitchen</div>
                    
                    <!-- Restrooms -->
                    <div class="restroom">Restrooms</div>
                </div>
                
                <div class="table-selection-info">
                    <p id="selected-table-info">Click on an available table to select it</p>
                </div>
            </div>
        </section>
        
        <!-- Customer Reviews -->
        <section class="reviews-section">
            <h2>Customer Reviews</h2>
            {% if reviews %}
                <div class="reviews-grid">
                    {% for review in reviews %}
                        <div class="review-card">
                            <div class="review-header">
                                <div class="reviewer-name">{{ review.customer.user.first_name }} {{ review.customer.user.last_name|first }}.</div>
                                <div class="review-stars" data-rating="{{ review.rating|default:0 }}"></div>
                            </div>
                            <p class="review-comment">{{ review.comment }}</p>
                            <div class="review-date">{{ review.created_at|timesince }} ago</div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="no-reviews-state">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor" opacity="0.3">
                        <path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.46,13.97L5.82,21L12,17.27Z"/>
                    </svg>
                    <h3>No reviews yet</h3>
                    <p>Be the first to share your dining experience!</p>
                </div>
            {% endif %}
        </section>
    </div>
    
    <!-- Reservation Form Sidebar -->
    <aside class="reservation-sidebar">
        <div class="reservation-form-card">
            <div class="form-header">
                <h3>Make Reservation</h3>
            </div>
            
            <form id="reservation-form" class="reservation-form" method="post">
                {% csrf_token %}
                <input type="hidden" id="restaurant-id" value="{{ restaurant.id }}">
                <input type="hidden" id="selected-table" name="table_number" value="">
                
                <div class="form-group">
                    <label for="guest-name">Full Name</label>
                    {{ reserve_form.name }}
                </div>
                
                <div class="form-group">
                    <label for="guest-email">Email Address</label>
                    {{ reserve_form.email }}
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="reservation-date">Date</label>
                        {{ reserve_form.date }}
                    </div>
                    <div class="form-group">
                        <label for="reservation-time">Time</label>
                        {{ reserve_form.time }}
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="guest-count">Number of Guests</label>
                    {{ reserve_form.guest_count }}
                </div>
                
                <div class="selected-table-display">
                    <div class="table-selection-status">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9Z"/>
                        </svg>
                        {{ reserve_form.table_numbers }}
                        <span id="table-status">No table selected</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="special-notes">Special Requests</label>
                    {{ reserve_form.notes }}
                </div>
                
                <button type="submit" class="reserve-btn" id="reserve-btn" disabled>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,5 19,5H18V3M17,12H12V17H17V12Z"/>
                    </svg>
                    Complete Reservation
                </button>
            </form>
            
            <div class="reservation-policies">
                <h4>Reservation Policies</h4>
                <ul>
                    <li>Free cancellation up to 24 hours before</li>
                    <li>Confirmation sent via email</li>
                    <li>Late arrivals may forfeit table after 15 minutes</li>
                    <li>Special dietary requirements accommodated</li>
                </ul>
            </div>
        </div>
    </aside>
</div>
{% endblock %}

{% block rr_base_js %}
<script src="{% static 'rr_app/js/util/Notifications.js' %}"></script>
<script src="{% static 'rr_app/js/restaurant_detail.js' %}"></script>
<script src="{% static 'rr_app/js/dashboard/stars.js' %}"></script>
{% endblock %}