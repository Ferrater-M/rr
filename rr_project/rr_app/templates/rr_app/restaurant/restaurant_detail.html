{% extends 'rr_app/restaurant/rr_base.html' %}
{% load static %}

{% block title %}{{ restaurant.name }} - Restaurant Detail{% endblock %}

{% block rr_base_css %}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Playfair+Display:wght@400;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="{% static 'rr_app/css/restaurant_detail.css' %}">
{% endblock %}

{% block rr_base_content %}
<!-- Cover Photo Section -->
<div class="cover-photo-container">
    {% if restaurant.image %}
        <div class="cover-photo" style="background-image: url('{{ restaurant.image.url }}')"></div>
    {% else %}
        <div class="cover-photo placeholder-cover">
            <div class="placeholder-content">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H5C3.9 1 3 1.9 3 3V21C3 22.1 3.9 23 5 23H19C20.1 23 21 22.1 21 21V9ZM19 19H5V3H14V8H19V19Z"/>
                </svg>
                <span>No image available</span>
            </div>
        </div>
    {% endif %}
    
    <!-- Restaurant Profile Section -->
    <div class="profile-section">
        <div class="profile-content">
            <div class="profile-header">
                <div class="profile-avatar">
                    {% if restaurant.image %}
                        <img src="{{ restaurant.image.url }}" alt="{{ restaurant.name }}" class="avatar-img">
                    {% else %}
                        <div class="avatar-placeholder">
                            <span>{{ restaurant.name|first }}</span>
                        </div>
                    {% endif %}
                </div>
                
                <div class="profile-info">
                    <h1 class="restaurant-name" id="restaurant-name">{{ restaurant.name }}</h1>
                    
                    <div class="restaurant-meta">
                        <div class="rating-container">
                            <div class="rating-stars" data-rating="{{ avg_rating|default:0 }}"></div>
                            <span class="rating-text">{{ avg_rating|floatformat:1 }} â€¢ {{ reviews|length }} review{{ reviews|length|pluralize }}</span>
                        </div>
                        
                        <div class="meta-info">
                            <span class="cuisine-badge">{{ restaurant.cuisine_type }}</span>
                            <span class="price-badge">P{{ restaurant.price|floatformat:0 }}</span>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-primary reserve-quick" onclick="scrollToReservation()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H5C3.9 1 3 1.9 3 3V21C3 22.1 3.9 23 5 23H19C20.1 23 21 22.1 21 21V9Z"/>
                            </svg>
                            Book Table
                        </button>
                        <button class="btn btn-secondary bookmark-btn" onclick="bookmarkRestaurant('{{ restaurant.id }}')" title="Save to favorites">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M17,3H7A2,2 0 0,0 5,5V21L12,18L19,21V5C19,3.89 18.1,3 17,3Z" />
                            </svg>
                        </button>
                        <button class="btn btn-secondary share-btn" title="Share restaurant">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18,16.08C17.24,16.08 16.56,16.38 16.04,16.85L8.91,12.7C8.96,12.47 9,12.24 9,12C9,11.76 8.96,11.53 8.91,11.3L15.96,7.19C16.5,7.69 17.21,8 18,8A3,3 0 0,0 21,5A3,3 0 0,0 18,2A3,3 0 0,0 15,5C15,5.24 15.04,5.47 15.09,5.7L8.04,9.81C7.5,9.31 6.79,9 6,9A3,3 0 0,0 3,12A3,3 0 0,0 6,15C6.79,15 7.5,14.69 8.04,14.19L15.16,18.34C15.11,18.55 15.08,18.77 15.08,19C15.08,20.61 16.39,21.91 18,21.91C19.61,21.91 20.92,20.61 20.92,19A2.84,2.84 0 0,0 18,16.08Z" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Main Content Container -->
<div class="main-content-container">
    
    <!-- Social Feed Style Content -->
    <div class="feed-container">
        <div class="feed-content">
            
            <!-- About Post -->
            <div class="feed-card about-card">
                <div class="card-header">
                    <div class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z"/>
                        </svg>
                        About
                    </div>
                </div>
                <div class="card-content">
                    <p class="description" id="restaurant-description">{{ restaurant.description }}</p>
                    
                    <!-- Tags -->
                    <div class="tags-section" id="tags-section">
                        {% for tag in restaurant.tags.all %}
                            <span class="tag">#{{ tag.tag }}</span>
                        {% endfor %}
                    </div>
                    
                    <!-- Quick Info Grid -->
                    <div class="info-grid">
                        <div class="info-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z"/>
                            </svg>
                            <span class="info-value" id="restaurant-address">{{ restaurant.address }}</span>
                        </div>
                        <div class="info-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M6.62,10.79C8.06,13.62 10.38,15.94 13.21,17.38L15.41,15.18C15.69,14.9 16.08,14.82 16.43,14.93C17.55,15.3 18.75,15.5 20,15.5A1,1 0 0,1 21,16.5V20A1,1 0 0,1 20,21A17,17 0 0,1 3,4A1,1 0 0,1 4,3H7.5A1,1 0 0,1 8.5,4C8.5,5.25 8.7,6.45 9.07,7.57C9.18,7.92 9.1,8.31 8.82,8.59L6.62,10.79Z"/>
                            </svg>
                            <a href="tel:{{ restaurant.phone_number }}" class="info-value" id="restaurant-phone">{{ restaurant.phone_number }}</a>
                        </div>
                        <div class="info-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M20,8L12,13L4,8V6L12,11L20,6M20,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6C22,4.89 21.1,4 20,4Z"/>
                            </svg>
                            <a href="mailto:{{ restaurant.email }}" class="info-value" id="restaurant-email">{{ restaurant.email }}</a>
                        </div>
                        <div class="info-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9Z"/>
                            </svg>
                            <span class="info-value">Since {{ restaurant.created_at|date:"F Y" }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reviews Feed -->
            <div class="feed-card reviews-card">
                <div class="card-header">
                    <div class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.46,13.97L5.82,21L12,17.27Z"/>
                        </svg>
                        Reviews
                    </div>
                </div>
                <div class="card-content">
                    <div class="reviews-list" id="reviews-list">
                        {% if reviews %}
                            {% for review in reviews %}
                                <div class="review-post">
                                    <div class="review-avatar">
                                        <div class="reviewer-initial">{{ review.customer.user.first_name|first }}</div>
                                    </div>
                                    <div class="review-content">
                                        <div class="review-header">
                                            <div class="reviewer-info">
                                                <span class="reviewer-name">
                                                    {{ review.customer.user.first_name }} {{ review.customer.user.last_name|first }}.
                                                </span>
                                                <div class="review-stars" data-rating="{{ review.rating|default:0 }}"></div>
                                            </div>
                                            <span class="review-date">{{ review.created_at|timesince }} ago</span>
                                        </div>
                                        <p class="review-comment">{{ review.comment }}</p>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="no-reviews">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor" opacity="0.3">
                                    <path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.46,13.97L5.82,21L12,17.27Z"/>
                                </svg>
                                <h3>No reviews yet</h3>
                                <p>Be the first to share your experience!</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
        </div>
        
        <!-- Sticky Reservation Sidebar -->
        <div class="sidebar-column">
            <div class="reservation-sticky">
                <div class="reservation-card" id="reservation-section">
                    <div class="reservation-header">
                        <h3>Reserve a Table</h3>
                        <div class="price-display">P{{ restaurant.price|floatformat:0 }} <span>per person</span></div>
                    </div>
                    
                    <form id="reservation-form" class="reservation-form" method="post">
                        {% csrf_token %}
                        <input type="hidden" id="restaurant-id" value="{{ restaurant.id }}">
                        
                        <div class="form-group">
                            <label for="guest-name">Full Name</label>
                            {{ reserve_form.name }}
                        </div>
                        
                        <div class="form-group">
                            <label for="guest-email">Email Address</label>
                            {{ reserve_form.email }}
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="reservation-date">Date</label>
                                {{ reserve_form.date }}
                            </div>
                            <div class="form-group">
                                <label for="reservation-time">Time</label>
                                {{ reserve_form.time }}
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="guest-count">Guests</label>
                            {{ reserve_form.guest_count }}
                        </div>
                        
                        <div class="form-group">
                            <label for="special-notes">Special Requests</label>
                            {{ reserve_form.notes }}
                        </div>
                        
                        <button type="submit" class="reserve-btn" id="reserve-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,5 19,5H18V3M17,12H12V17H17V12Z"/>
                            </svg>
                            Reserve Now
                        </button>
                    </form>
                    
                    <div class="reservation-footer">
                        <p><strong>Free cancellation</strong> up to 24 hours before your reservation</p>
                    </div>
                </div>
                
                <!-- Additional Info Card -->
                <div class="info-card">
                    <h4>Good to know</h4>
                    <div class="info-items">
                        <div class="info-item-small">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M16.2,16.2L11,13V7H12.5V12.2L17,14.9L16.2,16.2Z"/>
                            </svg>
                            <span>Usually booked 2-3 days in advance</span>
                        </div>
                        <div class="info-item-small">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M20,8L12,13L4,8V6L12,11L20,6M20,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6C22,4.89 21.1,4 20,4Z"/>
                            </svg>
                            <span>Confirmation sent via email</span>
                        </div>
                        <div class="info-item-small">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M17,3H7A2,2 0 0,0 5,5V21L12,18L19,21V5C19,3.89 18.1,3 17,3Z"/>
                            </svg>
                            <span>Special dietary requirements accommodated</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block rr_base_js %}
<script src="{% static 'rr_app/js/restaurant_detail.js' %}"></script>
<script src="{% static 'rr_app/js/dashboard/stars.js' %}"></script>
{% endblock %}